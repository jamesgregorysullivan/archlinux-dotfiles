# vim:fenc=utf-8:nu:ai:si:et:ts=2:sw=2:ft=muttrc

# --- directories and commands
set alias_file       = ~/.mutt/alias         # alias file
set header_cache     = ~/.mutt/cache/headers # where to store headers 
#set message_cachedir = ~/.mutt/cache/bodies  # where to store bodies
set certificate_file = ~/.mutt/certificates  # where to store certs
set mailcap_path     = ~/.mutt/mailcap       # entries for filetypes
set tmpdir           = ~/.mutt/temp          # where to keep temp files
set editor           = "/usr/bin/vim -c 'set tw=80 ft=mail' -c 'set wrap' -c 'set nocp'"
set ispell           = "/usr/bin/aspell -e -c" # use aspell as ispell
#set print_command    = /usr/bin/enscript      # print with enscript
set read_inc=5       # display download progress every 5K

# --- main options
set sort_alias     = alias   # sort alias file by alias
set reverse_alias            # show names from alias file in index
set delete                   # don't ask, just do
unset confirmappend          # don't ask, just do!
set quit                     # don't ask, just do!!
unset mark_old               # read/new is good enough for me
set pipe_decode              # strip headers and eval mimes when piping
set thorough_search          # strip headers and eval mimes before searching
set sleep_time=0
set send_charset="us-ascii:utf-8"   # charset priority
set auto_tag                 # apply functions in index menu only to tagged messages (if any)

# --- smtp server
set my_gmail_password   = `gpg --quiet --batch --use-agent --decrypt --output - ~/.mutt/password-gmail.gpg`
set smtp_url            = "smtp://kuba.klinkovsky:$my_gmail_password@smtp.gmail.com:587/"
set ssl_force_tls       = yes
set ssl_starttls        = yes

# --- gmail mailbox
set mbox_type       = Maildir   # mailbox type
set folder          = ~/Maildir
set spoolfile       = "+Gmail/INBOX"
set postponed       = "+Gmail/drafts"
unset record                    # don't save sent mail, gmail does it itself
set query_command   = "mail-query '%s' ~/Maildir/Gmail/INBOX"
set from            = "kuba.klinkovsky@gmail.com"

#macro index ,c "<change-folder>+Ideeli/INBOX<return>" "change accounts"
macro index D "<save-message>+Gmail/trash<enter>" "move message to the trash"
macro index S "<save-message>+Gmail/spam<enter>"  "mark message as spam"


# --- index options
set sort            = threads  # like gmail 
set sort_aux        = reverse-last-date-received # like gmail
set uncollapse_jump            # don't collapse on an unread message 
set sort_re                    # thread based on regex
set reply_regexp    = "^(([Rr][Ee]?(\[[0-9]+\])?: *)?(\[[^]]+\] *)?)*"

# --- pager options
set pager_index_lines = 10      # number of index lines to show 
set pager_context     = 5       # number of context lines to show
set pager_stop                  # don't go to next message automatically
set menu_scroll                 # scroll in menus 
set smart_wrap                  # don't split words
set tilde                       # show tildes like in vim
unset markers                   # no ugly plus signs
auto_view text/html             # view html automatically
alternative_order text/plain text/enriched text/html  # save html for last
set quote_regexp      = "^( {0,4}[>|:#%]| {0,4}[a-z0-9]+[>|]+)+"
set status_on_top               # as you'd expect

# --- sidebar
set sidebar_visible     = yes   # set sidebar visible
set sidebar_width       = 20    # width of sidebar in chars
set sidebar_shortpath   = yes   # shorten showed paths
set sidebar_format      = "%B%?F? [%F]?%* %?N?%N/?%4S"  # format string for sidebar

bind index,pager \CP sidebar-prev   # Ctrl-n to select next folder
bind index,pager \CN sidebar-next   # Ctrl-p to select previous folder
bind index,pager \CO sidebar-open   # Ctrl-o to open selected folder

# --- formats
set date_format   = "%d.%m.%y at %k:%M"
set index_format  = "%3C %S %D | %-26.26L %-50.100s %> %c"
set pager_format  = "Reading message %C of %m %> %lL (%P)" # pager statusbar
set folder_format = "%2C %t %N %8s %d %f"      # mailbox list view
set status_format = " %?M?%M/?%m total: %?n?%n new, ?%?u?%u unread, ?%?p?%p drafts, ?%?t?%t +tagged, ?%?d?%d deleted, ?(%f %l)  %?b?%b unread messages. ?%>  %V   sort by: %s/%S  (%P)"
set alias_format  = "%4n %t %-20a  %r"

# --- composing mail
set realname      = "Jakub Klinkovsk√Ω"                   # who am i?
set envelope_from               # which from?
set edit_headers                # show headers when composing
set fast_reply                  # skip to compose when replying
#set sendmail_wait  = -1         # don't wait for sending... to complete
#set askcc                       # ask for CC:
set fcc_attach                  # save attachments with the body
unset mime_forward              # forward attachments as part of body
set forward_format = "Fwd: %s"  # format for subject when forwarding
set forward_decode              # decode when forwarding
set attribution    = "On %d, %n wrote:" # set the attribution
set reply_to                    # reply to Reply to: field
set reverse_name                # reply as whomever it was to
set include                     # include message in replies
set forward_quote               # include message in forwards

# --- headers to show
ignore *                               # ignore all headers
unignore from: to: cc: date: subject:  # show only these
hdr_order from: to: cc: date: subject: # and in this order

# --- sourced bits
source ~/.mutt/mailboxes
source $alias_file
#source ~/.mutt/colors.muttrc
source ~/.mutt/gpg.rc
source ~/.mutt/mutt-colors-solarized/mutt-colors-solarized-dark-256.muttrc

# --- mailing lists
#lists arch-announce@archlinux.org      # Arch announcements
#subscribe arch-announce@archlinux.org
#
#lists arch-general@archlinux.org       # Arch general list
#subscribe arch-general@archlinux.org

# --- bindings
bind pager q            exit
bind pager /            search
bind pager <up>         previous-line
bind pager <down>       next-line
bind pager k            previous-line
bind pager j            next-line
bind pager gg           top
bind pager G            bottom
bind index gg           first-entry
bind index G            last-entry
bind index C            delete-pattern
bind pager K            previous-undeleted
bind pager J            next-undeleted
bind index K            previous-unread
bind index J            next-unread
bind index W            clear-flag
bind index w            set-flag
bind index,pager R      group-reply
bind compose p          pgp-menu
bind attach <return>    view-mailcap

# --- misc.
macro index \Cr "<tag-prefix><clear-flag>N" "mark tagged messages as read"
macro index \Cs "<pipe-message>cat > ~/"    "save message as" 
macro index B   "<limit>~b "                "search message bodies"

macro index,pager <F11> "<shell-escape>less /usr/share/doc/mutt/manual.txt<enter>" "Show Mutt documentation"
macro index,pager <F12> ":toggle help<enter>:set ?help<enter>" "toggle help status line"
macro index,pager <F5> ":source ~/.mutt/muttrc\n" "Reload the muttrc"

macro compose \Cg "Fgpg --clearsign\ny"
macro compose \Cp "Fgpg --clearsign\ny^T^Uapplication/pgp; format=text; x-action=sign\n"
macro compose Y pfy "send mail without pgp"

# --- address book
set query_command= "goobook query '%s'"
bind editor \t complete-query   # tab completion for contacts

# sync abook and alias
#macro index A   "!abook-autoexport\n:source ~/.mutt/alias\n" "Start abook"
#macro index \Ca "|abook-autoexport --add-email-quiet\n:source ~/.mutt/alias\n" "Create new alias from the message"
